<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Futterrechner</title>

<style>
body{font-family:Arial;margin:0;background:#eef1f4}
header{background:#2f3b45;color:#fff;padding:14px;text-align:center;font-size:20px}

.tabs{display:flex;background:#d5dbe0}
.tab{flex:1;padding:14px;text-align:center;font-size:17px;cursor:pointer}
.tab.active{background:#2f3b45;color:#fff}
.panel{padding:12px}
.hidden{display:none}

.category{border-radius:12px;margin-bottom:16px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.cat-header{padding:12px;color:#fff;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.cat-body{background:#fff;padding:12px}
.category.collapsed .cat-body{display:none}

.cat-kuehe{background:#2f80ed}
.cat-bullen{background:#27ae60}
.cat-trocken{background:#f2a900}

table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #ddd;padding:8px;text-align:right}
th:first-child,td:first-child{text-align:left}

tr:hover .sort-wrap{opacity:1}

.total{
  background:#2f3b45;color:#fff;padding:12px;border-radius:10px;
  display:flex;justify-content:space-between;align-items:center;
  font-size:18px;margin-top:10px
}

/* dezente Sortierpfeile */
.sort-wrap{
  opacity:0;
  transition:.2s;
  white-space:nowrap
}
.sort-btn{
  background:none;
  border:none;
  color:#999;
  font-size:14px;
  padding:2px 6px;
}
.sort-btn:hover{color:#333}

.agf{color:#b30000;font-weight:bold}
.mlf{color:#003399;font-weight:bold}

/* Taschenrechner */
.calc-box{max-width:340px;margin:20px auto;background:#fff;padding:14px;
border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.2)}
.calc-display{font-size:28px;padding:10px;background:#eef1f4;text-align:right;
border-radius:6px;margin-bottom:12px}
.calc-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.calc-btn{padding:18px;font-size:18px;border:none;border-radius:8px;background:#d5dbe0}
.calc-btn.op{background:#2f80ed;color:#fff}
.calc-btn.eq{background:#27ae60;color:#fff}
.calc-btn.clear{background:#b30000;color:#fff}
</style>
</head>

<body>

<header>üêÑ Futter-Rechner</header>

<div class="tabs">
  <div class="tab active" onclick="showTab('calc')">Rechner</div>
  <div class="tab" onclick="showTab('settings')">Einstellungen</div>
  <div class="tab" onclick="showTab('calc2')">Taschenrechner</div>
</div>

<div id="calc" class="panel"></div>
<div id="settings" class="panel hidden"></div>
<div id="calc2" class="panel hidden"></div>

<script>
function fmt(sec){
  sec=Math.round(sec);
  return Math.floor(sec/60)+" min "+(sec%60)+" s";
}

const CATS=[
 {id:"kuehe",name:"K√ºhe",cls:"cat-kuehe"},
 {id:"bullen",name:"Bullen",cls:"cat-bullen"},
 {id:"trocken",name:"Trockensteher",cls:"cat-trocken"}
];

function defItems(){
 let a=[];
 for(let i=1;i<=8;i++)a.push({name:"Futter "+i,kg:0});
 a.push({type:"agf",kg:0});
 a.push({type:"mlf",kg:0});
 return a;
}

let cfg=JSON.parse(localStorage.getItem("cfg"))||{
 agfName:"AGF",mlfName:"MLF",agfKg:0.5,mlfKg:0.5
};

let data=JSON.parse(localStorage.getItem("data"))||{
 kuehe:{anz:100,items:defItems(),collapsed:false},
 bullen:{anz:10,items:defItems(),collapsed:false},
 trocken:{anz:5,items:defItems(),collapsed:false}
};

function showTab(t){
 ["calc","settings","calc2"].forEach(id=>{
  document.getElementById(id).classList.toggle("hidden",id!==t)
 });
 document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
 document.querySelector(`.tab[onclick*='${t}']`).classList.add("active");
}

function moveItem(cat,i,dir){
 const arr=data[cat].items;
 const ni=i+dir;
 if(ni<0||ni>=arr.length)return;
 [arr[i],arr[ni]]=[arr[ni],arr[i]];
 save();buildCalc();
}

function itemName(it){
 if(it.type==="agf") return cfg.agfName;
 if(it.type==="mlf") return cfg.mlfName;
 return it.name;
}

function buildCalc(){
 calc.innerHTML="";
 CATS.forEach(c=>{
  let sum=0,lauf=0,rows="";
  data[c.id].items.forEach((it,i)=>{
   if(it.kg<=0)return;
   let g=it.kg*data[c.id].anz;
   let zeit="-";
   if(it.type==="agf")zeit=`<span class="agf">${fmt(g/cfg.agfKg)}</span>`;
   if(it.type==="mlf")zeit=`<span class="mlf">${fmt(g/cfg.mlfKg)}</span>`;
   lauf+=g;sum+=g;
   rows+=`
   <tr>
    <td>${itemName(it)}</td>
    <td>${g.toFixed(1)}</td>
    <td>${lauf.toFixed(1)}</td>
    <td>${zeit}</td>
    <td>
      <span class="sort-wrap">
        <button class="sort-btn" onclick="moveItem('${c.id}',${i},-1)">‚ñ≤</button>
        <button class="sort-btn" onclick="moveItem('${c.id}',${i},1)">‚ñº</button>
      </span>
    </td>
   </tr>`;
  });

  calc.innerHTML+=`
  <div class="category">
   <div class="cat-header ${c.cls}"
    onclick="data.${c.id}.collapsed=!data.${c.id}.collapsed;save();buildCalc()">
    <strong>${c.name}</strong><span>${data[c.id].collapsed?'‚ñº':'‚ñ≤'}</span>
   </div>
   <div class="cat-body">
    Tiere:
    <input type="number" value="${data[c.id].anz}"
      oninput="data.${c.id}.anz=this.valueAsNumber||0;save()"
      onblur="buildCalc()">
    <table>
     <tr><th>Futter</th><th>kg</th><th>Summe</th><th>Zeit</th><th></th></tr>
     ${rows||"<tr><td colspan=5 style='text-align:center;color:#888'>keine Daten</td></tr>"}
    </table>
    <div class="total">Gesamt: ${sum.toFixed(1)} kg</div>
   </div>
  </div>`;
 });
}

function buildSettings(){
 settings.innerHTML=`
 <h3>AGF / MLF</h3>
 AGF Name <input value="${cfg.agfName}"
   oninput="cfg.agfName=this.value;save();buildCalc()"><br>
 kg/s <input type="number" step="0.01" value="${cfg.agfKg}"
   oninput="cfg.agfKg=this.valueAsNumber||0.01;save();buildCalc()"><br><br>
 MLF Name <input value="${cfg.mlfName}"
   oninput="cfg.mlfName=this.value;save();buildCalc()"><br>
 kg/s <input type="number" step="0.01" value="${cfg.mlfKg}"
   oninput="cfg.mlfKg=this.valueAsNumber||0.01;save();buildCalc()"><hr>
 `;
 CATS.forEach(c=>{
  settings.innerHTML+=`<h3>${c.name}</h3>`;
  data[c.id].items.forEach((it,i)=>{
   settings.innerHTML+=`
   <div>
    ${it.type? itemName(it):
      `<input value="${it.name}"
        oninput="data.${c.id}.items[${i}].name=this.value;save();buildCalc()">`}
    <input type="number" step="0.01" value="${it.kg}"
      oninput="data.${c.id}.items[${i}].kg=this.valueAsNumber||0;save();buildCalc()">
   </div>`;
  });
 });
}

let cv="",last=null,op=null;
function calcPress(v){
 const d=document.getElementById("calcDisp");
 if(!isNaN(v)){cv+=v;d.innerText=cv;return;}
 if(v==="C"){cv="";last=null;op=null;d.innerText="0";return;}
 if("+-√ó√∑".includes(v)){
  if(last!==null&&cv!=="") last=calcDo(last,parseFloat(cv),op);
  else if(cv!=="") last=parseFloat(cv);
  op=v;cv="";d.innerText=last;return;
 }
 if(v==="="&&last!==null&&cv!==""){
  last=calcDo(last,parseFloat(cv),op);
  d.innerText=last;cv="";op=null;
 }
}
function calcDo(a,b,o){
 if(o==="+")return a+b;
 if(o==="‚àí")return a-b;
 if(o==="√ó")return a*b;
 if(o==="√∑")return b?a/b:0;
 return b;
}

function buildCalc2(){
 const b=["7","8","9","√∑","4","5","6","√ó","1","2","3","‚àí","C","0","=","+"];
 calc2.innerHTML=`<div class="calc-box">
 <div id="calcDisp" class="calc-display">0</div>
 <div class="calc-grid">
 ${b.map(x=>`<button class="calc-btn ${"+‚àí√ó√∑".includes(x)?'op':''}
 ${x==='='?'eq':''} ${x==='C'?'clear':''}"
 onclick="calcPress('${x}')">${x}</button>`).join("")}
 </div></div>`;
}

function save(){
 localStorage.setItem("cfg",JSON.stringify(cfg));
 localStorage.setItem("data",JSON.stringify(data));
}

buildCalc();
buildSettings();
buildCalc2();
</script>

</body>
</html>
