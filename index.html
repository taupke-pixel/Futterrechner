<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Futterrechner</title>

<style>
body{font-family:Arial;margin:0;background:#eef1f4}
header{background:#2f3b45;color:#fff;padding:12px;text-align:center;font-size:20px}

.tabs{display:flex}
.tab{flex:1;padding:12px;text-align:center;background:#d5dbe0;cursor:pointer}
.tab.active{background:#2f3b45;color:#fff}

.panel{padding:12px}
.hidden{display:none}

/* Kategorien */
.category{
  border-radius:12px;
  margin-bottom:16px;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.1)
}
.cat-header{
  padding:12px;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  display:flex;
  justify-content:space-between
}
.cat-body{background:#fff;padding:12px}
.category.collapsed .cat-body{display:none}

/* üîπ Fokus / Vollbild-Ansicht */
.category.focus{
  margin-bottom:0;
}
.category.focus .cat-body{
  min-height:calc(100vh - 180px);
}

.cat-kuehe{background:#2f80ed}
.cat-bullen{background:#27ae60}
.cat-trocken{background:#f2a900}

/* Tabellen */
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #ddd;padding:6px;text-align:right}
th:first-child,td:first-child{text-align:left}

/* Summen */
.total{
  background:#2f3b45;
  color:#fff;
  padding:10px;
  border-radius:8px;
  margin-top:8px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
.kilo-btn{padding:6px 12px;border-radius:6px;border:none;background:#ccc}
.kilo-btn.active{background:#2f80ed;color:#fff}

.agf{color:#b30000;font-weight:bold}
.mlf{color:#003399;font-weight:bold}
</style>
</head>

<body>

<header>üêÑ Futterrechner</header>

<div class="tabs">
  <div class="tab active" onclick="showTab('calc')">Rechner</div>
  <div class="tab" onclick="showTab('settings')">Einstellungen</div>
  <div class="tab" onclick="showTab('calc2')">Taschenrechner</div>
</div>

<div id="calc" class="panel"></div>
<div id="settings" class="panel hidden"></div>
<div id="calc2" class="panel hidden"></div>

<script>
function fmt(sec){
  sec=Math.round(sec);
  return Math.floor(sec/60)+" min "+(sec%60)+" s";
}

let globalCfg=JSON.parse(localStorage.getItem("gCfg"))||{
  agfName:"AGF",mlfName:"MLF",agfKg:0.5,mlfKg:0.5
};

const CATS=[
  {id:"kuehe",name:"K√ºhe",cls:"cat-kuehe"},
  {id:"bullen",name:"Bullen",cls:"cat-bullen"},
  {id:"trocken",name:"Trockensteher",cls:"cat-trocken"}
];

function defItems(){
  let a=[];
  for(let i=1;i<=8;i++)a.push({name:"Futter "+i,kg:0});
  a.push({type:"agf",kg:0});
  a.push({type:"mlf",kg:0});
  return a;
}

let data=JSON.parse(localStorage.getItem("futter"))||{
  kuehe:{anz:100,items:defItems(),collapsed:false},
  bullen:{anz:10,items:defItems(),collapsed:false},
  trocken:{anz:5,items:defItems(),collapsed:false}
};

/* üîπ Fokus-Logik */
function toggleCategory(catId, el){
  const wasCollapsed = data[catId].collapsed;

  Object.keys(data).forEach(k=>{
    data[k].collapsed=true;
  });

  data[catId].collapsed = !wasCollapsed;
  save();
  buildCalc();

  setTimeout(()=>{
    if(!wasCollapsed){
      el.closest(".category").scrollIntoView({behavior:"smooth",block:"start"});
    }
  },50);
}

function buildCalc(){
  calc.innerHTML="";
  CATS.forEach(c=>{
    let sum=0,rows="";
    data[c.id].items.forEach(it=>{
      if(it.kg<=0)return;
      let g=it.kg*data[c.id].anz;
      let name=it.type==="agf"?globalCfg.agfName:
               it.type==="mlf"?globalCfg.mlfName:it.name;
      let zeit="-";
      if(it.type==="agf")zeit=`<span class="agf">${fmt(g/globalCfg.agfKg)}</span>`;
      if(it.type==="mlf")zeit=`<span class="mlf">${fmt(g/globalCfg.mlfKg)}</span>`;
      sum+=g;
      rows+=`<tr><td>${name}</td><td>${g.toFixed(1)}</td><td>${zeit}</td></tr>`;
    });

    calc.innerHTML+=`
    <div class="category ${data[c.id].collapsed?'':'focus'} ${data[c.id].collapsed?'collapsed':''}">
      <div class="cat-header ${c.cls}"
        onclick="toggleCategory('${c.id}',this)">
        ${c.name}<span>${data[c.id].collapsed?'‚ñº':'‚ñ≤'}</span>
      </div>
      <div class="cat-body">
        <table>
          <tr><th>Futter</th><th>kg</th><th>Zeit</th></tr>
          ${rows||"<tr><td colspan=3>‚Äì</td></tr>"}
        </table>
        <div class="total">Gesamt: ${sum.toFixed(1)} kg</div>
      </div>
    </div>`;
  });
}

function save(){localStorage.setItem("futter",JSON.stringify(data))}
buildCalc();
</script>

</body>
</html>
