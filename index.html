<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Futterrechner ‚Äì TEST Einf√ºgen-Modus</title>
<style>
body{font-family:Arial;margin:0;background:#eef1f4}
header{background:#2f3b45;color:#fff;padding:12px;text-align:center;font-size:20px}
.tabs{display:flex}
.tab{flex:1;padding:12px;text-align:center;background:#d5dbe0;cursor:pointer}
.tab.active{background:#2f3b45;color:#fff}
.panel{padding:12px}
.hidden{display:none}

.category{background:#fff;border-radius:10px;margin-bottom:16px;padding:10px}
.row{display:flex;align-items:center;gap:8px;margin:6px 0}
.row .name{flex:1}
.row.selected{background:#eef5ff;border-radius:6px}
.btn{padding:4px 8px}

.insert{
  text-align:center;
  color:#2f80ed;
  padding:6px;
  border:1px dashed #2f80ed;
  border-radius:6px;
  margin:6px 0;
  cursor:pointer;
  font-size:14px;
}
.insert:hover{background:#eef5ff}
</style>
</head>
<body>

<header>üêÑ Futterrechner ‚Äì TEST Einf√ºgen-Modus</header>

<div class="tabs">
  <div class="tab active" onclick="showTab('calc')">Rechner</div>
  <div class="tab" onclick="showTab('settings')">Einstellungen</div>
</div>

<div id="calc" class="panel"></div>
<div id="settings" class="panel hidden"></div>

<script>
const CATS=["K√ºhe","Bullen","Trockensteher"];
let state = JSON.parse(localStorage.getItem("insert_test")) || {
  cats: CATS.map(n=>({
    name:n,
    sort:false,
    moving:null,
    items:[
      {id:"f1",name:"Futter 1"},
      {id:"f2",name:"Futter 2"},
      {id:"f3",name:"Futter 3"},
      {id:"f4",name:"Futter 4"},
      {id:"f5",name:"Futter 5"},
      {id:"f6",name:"Futter 6"},
      {id:"f7",name:"Futter 7"},
      {id:"f8",name:"Futter 8"},
      {id:"agf",name:"AGF"},
      {id:"mlf",name:"MLF"}
    ]
  }))
};

function save(){localStorage.setItem("insert_test",JSON.stringify(state))}

function showTab(t){
  calc.classList.toggle("hidden",t!=="calc");
  settings.classList.toggle("hidden",t!=="settings");
  document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
  document.querySelector(`.tab[onclick*=${t}]`).classList.add("active");
}

function startMove(cat,i){
  cat.moving=i; save(); render();
}

function insertAt(cat,idx){
  const i=cat.moving;
  if(i===null) return;
  const item=cat.items.splice(i,1)[0];
  const target = idx>i ? idx-1 : idx;
  cat.items.splice(target,0,item);
  cat.moving=null; save(); render();
}

function render(){
  calc.innerHTML=""; settings.innerHTML="";
  state.cats.forEach((cat,ci)=>{
    // Rechner
    let c=document.createElement("div");
    c.className="category";
    c.innerHTML=`<h3>${cat.name}
      <button class="btn" onclick="state.cats[${ci}].sort=!state.cats[${ci}].sort;save();render()">Sortieren</button>
    </h3>`;
    if(cat.sort && cat.moving!==null){
      c.appendChild(makeInsert(cat,0));
    }
    cat.items.forEach((it,i)=>{
      let r=document.createElement("div");
      r.className="row"+(cat.moving===i?" selected":"");
      r.innerHTML=`
        <span class="name">${it.name}</span>
        ${cat.sort?`<button class="btn" onclick="startMove(state.cats[${ci}],${i})">Verschieben</button>`:""}
      `;
      c.appendChild(r);
      if(cat.sort && cat.moving!==null){
        c.appendChild(makeInsert(cat,i+1));
      }
    });
    calc.appendChild(c);

    // Einstellungen (gleiche Reihenfolge!)
    let s=document.createElement("div");
    s.className="category";
    s.innerHTML=`<h3>${cat.name} ‚Äì Einstellungen</h3>`;
    cat.items.forEach(it=>{
      let r=document.createElement("div");
      r.className="row";
      r.innerHTML=`<span class="name">${it.name}</span>`;
      s.appendChild(r);
    });
    settings.appendChild(s);
  });
}

function makeInsert(cat,idx){
  let d=document.createElement("div");
  d.className="insert";
  d.textContent="Einf√ºgen hier";
  d.onclick=()=>insertAt(cat,idx);
  return d;
}

render();
</script>
</body>
</html>
