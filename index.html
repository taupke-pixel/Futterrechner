<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Futterrechner ‚Äì DragDrop Test</title>

<style>
body{font-family:Arial;margin:0;background:#eef1f4}
header{background:#2f3b45;color:#fff;padding:14px;text-align:center;font-size:20px}

.category{
  border-radius:12px;margin:16px;overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.1)
}
.cat-header{
  padding:12px;color:#fff;font-weight:bold
}
.cat-body{background:#fff;padding:12px}

.cat-kuehe{background:#2f80ed}
.cat-bullen{background:#27ae60}
.cat-trocken{background:#f2a900}

table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #ddd;padding:8px;text-align:right}
th:first-child,td:first-child{text-align:left}

tr.draggable{cursor:grab}
tr.dragging{opacity:.4}
tr.over{outline:2px dashed #2f80ed}

.total{
  background:#2f3b45;color:#fff;
  padding:10px;border-radius:8px;
  font-size:18px;margin-top:10px
}

.agf{color:#b30000;font-weight:bold}
.mlf{color:#003399;font-weight:bold}
</style>
</head>

<body>

<header>üêÑ Futter-Rechner ‚Äì Drag & Drop Test</header>

<div id="app"></div>

<script>
function fmt(sec){
  sec=Math.round(sec);
  return Math.floor(sec/60)+" min "+(sec%60)+" s";
}

const CATS=[
 {id:"kuehe",name:"K√ºhe",cls:"cat-kuehe"},
 {id:"bullen",name:"Bullen",cls:"cat-bullen"},
 {id:"trocken",name:"Trockensteher",cls:"cat-trocken"}
];

function defItems(){
 let a=[];
 for(let i=1;i<=8;i++) a.push({name:"Futter "+i,kg:1});
 a.push({type:"agf",kg:1});
 a.push({type:"mlf",kg:1});
 return a;
}

let cfg={agfName:"AGF",mlfName:"MLF",agfKg:0.5,mlfKg:0.5};

let data={
 kuehe:{anz:50,items:defItems()},
 bullen:{anz:10,items:defItems()},
 trocken:{anz:5,items:defItems()}
};

let dragIndex=null, dragCat=null;

function onDragStart(e,cat,i){
 dragIndex=i; dragCat=cat;
 e.currentTarget.classList.add("dragging");
}
function onDragOver(e){e.preventDefault();e.currentTarget.classList.add("over")}
function onDragLeave(e){e.currentTarget.classList.remove("over")}
function onDrop(e,cat,i){
 e.preventDefault();
 e.currentTarget.classList.remove("over");
 if(dragCat!==cat||dragIndex===null)return;
 const arr=data[cat].items;
 const item=arr.splice(dragIndex,1)[0];
 arr.splice(i,0,item);
 dragIndex=null; dragCat=null;
 build();
}

function build(){
 const app=document.getElementById("app");
 app.innerHTML="";
 CATS.forEach(c=>{
  let sum=0,lauf=0,rows="";
  data[c.id].items.forEach((it,i)=>{
   if(it.kg<=0)return;
   let g=it.kg*data[c.id].anz;
   let name=it.type==="agf"?cfg.agfName:
            it.type==="mlf"?cfg.mlfName:it.name;
   let zeit="-";
   if(it.type==="agf")zeit=`<span class="agf">${fmt(g/cfg.agfKg)}</span>`;
   if(it.type==="mlf")zeit=`<span class="mlf">${fmt(g/cfg.mlfKg)}</span>`;
   lauf+=g; sum+=g;

   rows+=`
   <tr class="draggable" draggable="true"
     ondragstart="onDragStart(event,'${c.id}',${i})"
     ondragover="onDragOver(event)"
     ondragleave="onDragLeave(event)"
     ondrop="onDrop(event,'${c.id}',${i})">
     <td>${name}</td>
     <td>${g.toFixed(1)}</td>
     <td>${lauf.toFixed(1)}</td>
     <td>${zeit}</td>
   </tr>`;
  });

  app.innerHTML+=`
  <div class="category">
    <div class="cat-header ${c.cls}">${c.name}</div>
    <div class="cat-body">
      <table>
        <tr><th>Futter</th><th>kg</th><th>Summe</th><th>Zeit</th></tr>
        ${rows}
      </table>
      <div class="total">Gesamt: ${sum.toFixed(1)} kg</div>
    </div>
  </div>`;
 });
}

build();
</script>

</body>
</html>
