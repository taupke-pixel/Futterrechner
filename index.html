<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Futterrechner</title>

<style>
body{font-family:Arial;margin:0;background:#eef1f4}
header{background:#2f3b45;color:#fff;padding:12px;text-align:center;font-size:20px}
.tabs{display:flex}
.tab{flex:1;padding:12px;text-align:center;background:#d5dbe0;cursor:pointer}
.tab.active{background:#2f3b45;color:#fff}
.panel{padding:12px}
.hidden{display:none}

.category{border-radius:12px;margin-bottom:16px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.cat-header{padding:12px;color:#fff}
.cat-body{background:#fff;padding:12px}

.cat-kuehe{background:#2f80ed}
.cat-bullen{background:#27ae60}
.cat-trocken{background:#f2a900}

table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #ddd;padding:6px;text-align:right}
th:first-child,td:first-child{text-align:left}

.sort-btn{
  border:none;
  background:#eef1f4;
  font-size:14px;
  padding:2px 6px;
  margin-right:4px;
  cursor:pointer;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  background:#2f80ed;
  color:#fff;
  cursor:pointer;
}
button.secondary{background:#777}
</style>
</head>

<body>

<header>üêÑ Futterrechner</header>

<div class="tabs">
  <div class="tab active" onclick="showTab('calc')">Rechner</div>
  <div class="tab" onclick="showTab('settings')">Einstellungen</div>
</div>

<div id="calc" class="panel"></div>
<div id="settings" class="panel hidden"></div>

<script>
let sortMode = false;

let globalCfg = JSON.parse(localStorage.getItem("gCfg")) || {
  agfName:"AGF", mlfName:"MLF", agfKg:0.5, mlfKg:0.5
};

const CATS = [
  {id:"kuehe",name:"K√ºhe",cls:"cat-kuehe"},
  {id:"bullen",name:"Bullen",cls:"cat-bullen"},
  {id:"trocken",name:"Trockensteher",cls:"cat-trocken"}
];

function defItems(){
  let a=[];
  for(let i=1;i<=8;i++)a.push({name:"Futter "+i,kg:0});
  a.push({type:"agf",kg:0});
  a.push({type:"mlf",kg:0});
  return a;
}

let data = JSON.parse(localStorage.getItem("futter")) || {
  kuehe:{anz:100,items:defItems()},
  bullen:{anz:10,items:defItems()},
  trocken:{anz:5,items:defItems()}
};

function showTab(t){
  calc.classList.toggle("hidden",t!=="calc");
  settings.classList.toggle("hidden",t!=="settings");
  document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
  document.querySelector(`.tab[onclick*='${t}']`).classList.add("active");
}

function moveItem(cat,idx,dir){
  const a=data[cat].items;
  const n=idx+dir;
  if(n<0||n>=a.length)return;
  [a[idx],a[n]]=[a[n],a[idx]];
  save();
  buildSettings();
  buildCalc();
}

/* -------- Rechner -------- */
function buildCalc(){
  calc.innerHTML="";
  CATS.forEach(c=>{
    let rows="";
    data[c.id].items.forEach(it=>{
      if(it.kg<=0)return;
      let name = it.type==="agf"?globalCfg.agfName:
                 it.type==="mlf"?globalCfg.mlfName:it.name;
      rows+=`<tr><td>${name}</td><td>${(it.kg*data[c.id].anz).toFixed(1)}</td></tr>`;
    });

    calc.innerHTML+=`
    <div class="category">
      <div class="cat-header ${c.cls}">${c.name}</div>
      <div class="cat-body">
        <table>
          <tr><th>Futter</th><th>kg</th></tr>
          ${rows||"<tr><td colspan=2>‚Äì</td></tr>"}
        </table>
      </div>
    </div>`;
  });
}

/* -------- Einstellungen -------- */
function buildSettings(){
  settings.innerHTML=`
    <h3>Sortierung</h3>
    <button onclick="toggleSort()">
      ${sortMode ? "Sortieren beenden" : "Sortieren aktivieren"}
    </button>
    <hr>
  `;

  CATS.forEach(c=>{
    settings.innerHTML+=`<h3>${c.name}</h3>`;
    data[c.id].items.forEach((it,i)=>{
      let name = it.type==="agf"?globalCfg.agfName:
                 it.type==="mlf"?globalCfg.mlfName:it.name;

      settings.innerHTML+=`
      <div style="background:#fff;padding:6px;margin-bottom:6px">
        ${sortMode ? `
          <button class="sort-btn" onclick="moveItem('${c.id}',${i},-1)">‚ñ≤</button>
          <button class="sort-btn" onclick="moveItem('${c.id}',${i},1)">‚ñº</button>
        ` : ""}
        ${name}
      </div>`;
    });
  });
}

function toggleSort(){
  sortMode = !sortMode;
  buildSettings();
}

function save(){
  localStorage.setItem("futter",JSON.stringify(data));
}

buildCalc();
buildSettings();
</script>

</body>
</html>
